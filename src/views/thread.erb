<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../../static/dangeru.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="static/favicon.ico">
    <% results = con.query("SELECT * FROM posts WHERE parent = #{id.to_i} OR post_id = #{id.to_i} ORDER BY post_id") %>
    <title>Thread <%= id %> on danger/<%= path %>/ Loading...</title>
  </head>
  <body>
    <div id="sitecorner">
      <a href="/<%= path %>"><img src="<%= banner %>" alt="danger/u/"></a> 
      <%= last_date_modified = Time.new 0 %>
      <%= i = 0 %>
      <% is_locked = false %>
      <% results.each do |res| %>
        <% if i == 0 then %>
          <% is_locked = res["is_locked"] != 0 %>
          <div id="title"><%= Sanitize.clean(res["title"]) %></div>
          <script>
            document.title = <%= JSON.dump(res["title"]) %> + " - /danger/" + <%= JSON.dump(res["board"]) %> + "/";
          </script>
        <% end %>
        <div class="comment">
          | 
          <% res["content"].split("\n").each do |line| %>
            <% line = line.chomp %>
            <% depth = 0 %>
            <% while line[depth] == ">" do depth += 1 end %>
            <% if depth > 0 %>
              <span class="redtext redtext-<%= depth %>">
            <% end %>
            <%= Sanitize.clean(line) %>
            <% if depth > 0 %>
              </span>
            <% end %>
            <br />
          <% end %>
        </div>
        <br />
        <% last_date_modified = res["date_posted"] %>
        <% i += 1 %>
      <% end %>

      <div style="font-size: 11px;" class="comment">
        Total number of posts: <%= i.to_s %>,
        last modified on:
        <span id='date_last_modified'>
          <%= last_date_modified.strftime '%c' %>
        </span>
      </div>
      <script>
        var d = new Date(parseInt(<%= JSON.dump(last_date_modified.strftime '%s') %> + "000"));
        document.getElementById("date_last_modified").innerHTML = d.toString();
      </script>
      <br />
      <% if is_locked then %>
        <div class="redtext" style="text-align: center;">This thread is closed.</div>
      <% else %>
        <a href="javascript:location.reload();">Refresh</a>
        <form action='/reply' method='post'>
          <input type='text' style='display: none' name='board' id='board' value='<%= path %>' />
          <input type='text' style='display: none' name='parent' id='parent' value='<%= id %>' />
          <input type='text' name='content' id='board' placeholder='Reply' />
          <input type='submit' />
        </form>
      <% end %>
      <br />
    </div>
    <footer class="comment" style="font-size: xx-small; text-align: center;">
      <small>Awoo <%= settings.awoo_version %></small>
    </footer>
  </body>
</html>
